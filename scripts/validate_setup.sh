#!/bin/bash

# Hardware setup validation script for STM32F103C8T6 Quadrature Generator

echo "STM32F103C8T6 Quadrature Generator - Hardware Setup Validation"
echo "============================================================="
echo ""

echo "ğŸ“‹ Pin Configuration Checklist:"
echo ""
echo "Power and Clock:"
echo "  â˜ VCC connected to 3.3V"
echo "  â˜ GND connected to ground"
echo "  â˜ External 8MHz crystal installed (or HSI will be used)"
echo ""

echo "Quadrature Outputs:"
echo "  â˜ PA8  (TIM1_CH1) - Quadrature Output A"
echo "  â˜ PA9  (TIM1_CH2) - Quadrature Output B"
echo "  â˜ PA10 (TIM2_CH3) - Quadrature Output C (90Â° shifted)"
echo "  â˜ PA11 (TIM2_CH4) - Quadrature Output D (90Â° shifted)"
echo ""

echo "User Interface:"
echo "  â˜ PA0  - Potentiometer center tap (10kÎ© recommended)"
echo "  â˜ PA12 - Enable button (pulled up, active low)"
echo "  â˜ PA15 - Disable button (pulled up, active low)"
echo "  â˜ PC13 - Status LED (built-in on Blue Pill)"
echo ""

echo "Communication:"
echo "  â˜ PA2  - UART TX (115200 baud)"
echo "  â˜ PA3  - UART RX (115200 baud)"
echo ""

echo "ğŸ”§ Software Requirements:"
echo "  â˜ ARM GCC toolchain installed"
echo "  â˜ CMake version 3.20 or higher"
echo "  â˜ STM32 programming tool (st-flash, OpenOCD, etc.)"
echo ""

echo "ğŸ§ª Testing Procedure:"
echo ""
echo "1. Power on the STM32F103C8T6 board"
echo "2. Connect UART terminal at 115200 baud"
echo "3. You should see: 'STM32F103 Quadrature Generator v1.0'"
echo "4. Adjust potentiometer - frequency should change between 10Hz-1kHz"
echo "5. Press enable button - LED should turn on, outputs should start"
echo "6. Press disable button - LED should turn off, outputs should stop"
echo "7. Monitor UART for status updates every 500ms:"
echo "   Format: 'ADC: XXXX, Freq: XXXHz, Output: ON/OFF'"
echo ""

echo "ğŸ“Š Expected Waveforms:"
echo ""
echo "With oscilloscope connected to PA8, PA9, PA10, PA11:"
echo "  â€¢ All outputs should be square waves with 50% duty cycle"
echo "  â€¢ PA8 and PA9 should be in phase"
echo "  â€¢ PA10 and PA11 should be 90Â° ahead of PA8/PA9"
echo "  â€¢ Frequency should match UART-reported frequency"
echo "  â€¢ All outputs should start/stop together when enabled/disabled"
echo ""

echo "ğŸ› Troubleshooting:"
echo ""
echo "No UART output:"
echo "  â†’ Check wiring of PA2 (TX) and PA3 (RX)"
echo "  â†’ Verify baud rate is set to 115200"
echo "  â†’ Check power supply and reset"
echo ""
echo "No quadrature outputs:"
echo "  â†’ Ensure enable button has been pressed"
echo "  â†’ Check LED status on PC13"
echo "  â†’ Verify timer pin connections (PA8-PA11)"
echo ""
echo "Incorrect frequency:"
echo "  â†’ Check potentiometer wiring to PA0"
echo "  â†’ Verify potentiometer is connected between VCC and GND"
echo "  â†’ Check ADC readings in UART output"
echo ""
echo "Phase relationship incorrect:"
echo "  â†’ This indicates timer synchronization issue"
echo "  â†’ Check firmware configuration and rebuild"
echo ""

echo "âœ… Setup validation complete!"
echo "For more details, see README.md in the project root."